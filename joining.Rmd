---
title: "Joining dataframes using dplyr"
author: "Erika Braithwaite  \newline"
date: "March 15, 2018"
output:
  slidy_presentation: default
  beamer_presentation: default
  ioslides_presentation: default
incremental: yes
subtitle: RLadies Montreal
theme: metropolis
header-includes:
- \usepackage{tikz}
- \usepackage{pgfplots}
- \usepackage{graphicx}
- \usepackage{bm}
- \usepackage{amsmath}
- \usepackage{amssymb}
- \usepackage{mathtools}
- \usetikzlibrary{shadows,shapes,arrows,automata,calc,shapes.geometric,shapes.multipart,positioning,trees}
---


## 0. What is joining?

We often run into scenarios where we need to join two dataframes together. Let's say we had some students who were given an IQ test at a career fair. Some of the students showed up at on both days, but not all. They were given unique alphanumeric identifiers.


Set up
```{r}
#install.packages('pacman')
pacman::p_load(knitr, data.table, dplyr)
```

## 1. What is joining?   

```{r, echo = T}
day1 =  data.table(ID=LETTERS[1:12],
                 IQ=round(rnorm(12, 100, 15),2))

day2 =  data.table(ID=LETTERS[6:17],
                 IQ=round(rnorm(12, 100, 20),2))
```
```{r, echo = T}
kable(list(day1, day2))
```

## 2. Three types of joins in dplyr 

If we wanted to merge the two dataframes together, we can use dplyr's joining functions:

1. Mutating join: add a new variables to one table from matching rows in another
        i. left_join
        ii. right_join
        iii. inner_join
        iv. outer_join

2. Filtering join: filter observations from one tables based on whether they match 
        i. semi_join
        ii. anti_join

3. Set operations: 
        i. intersect
        ii. union
        iii. setdiff

## 1. More on the types of joins 

 
 
 
 \vspace{2mm} 
 

## 3. dplyr versus data.table versus base R

* data.table


```{r, eval = F}
rbind(...,use.names = T, fill = F, idcol = NULL)
```

Base R 
```{r, eval = F}
rbind(...,deparse.level = 1, make.row.names = T)
```


## 4. When joining can get tricky... 
- Joining with columns having the same name but different encoding (UTF-8 vs. Latin)
- Joining with columns having different storage types (factors, integers, bit64, dates)
-

## 5. How to choose?

Dplyr has come a long way in terms of speed. Recent benchmarking conducted in Stack Overflow showed that dplyr starts to substantially lag when there are a large number of groups (>100k). 
While this point is contentious, if you've been a long standing tidyversalist, then you might find data.table's syntax more difficult to learn.   



## 5. Advantages and Disadvantages of each approach




## 6. More!

There are additional types of joins not covered here: rolling joins, scaling joins

Resources



## Thank-you 

\small
\textbf{Committee member \& unofficial 3rd supervisor} \newline
Dr. Gavin Shaddick, University of Bath, Dept Math   

\vspace{2mm}
\textbf{Supervisors} \newline
Dr. David Buckeridge, McGill EBOH \newline
Dr. Sarah Henderson, BCCDC \& UBC SPPH 

\vspace{2mm}

Dr. Finn Lindgren, INLA research & development team 

\vspace{2mm}

British Columbia Centre for Disease Control (BCCDC)  

\vspace{2mm}

McGill Surveillance Lab

\vspace{5mm}

\definecolor{tempcolor2}{HTML}{ADCAB4}
\setbeamercolor{tealbox}{bg=tempcolor2!75}
\begin{beamercolorbox}[sep=1mm]{tealbox}
\footnotesize
Morrison KT, Shaddick G, Henderson SB, Buckeridge DL. 2016. `A latent process model for forecasting multiple time series in environmental public health surveillance.' \emph{Statistics in Medicine.} DOI: 10.1002/sim.6904
\end{beamercolorbox}


